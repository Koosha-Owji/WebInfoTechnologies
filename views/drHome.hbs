
<h1>Patients of {{user.firstName}} {{user.lastName}} </h1>


{{!-- {{ Iterate through every patient}} --}}
<div class="row_containers">
    <div class="patient_rows">
        {{#each patients as |patient|}}
            <div class="patient_info">
                <p><a href="/hard_data/{{patient.username}}">Patient Name: {{patient.firstName}} {{patient.lastName}}</a></p>
                <p>Medical Data Added Today</p>

                {{!-- {{ Check to see if the Dr needs to see exercise}} --}}
                {{#if patient.exerciseRequired}}
                    {{!-- {{ Iterate through every glucose post to find the most recent from this patient}} --}}
                    {{#each ../exercisePost as |userDataPost|}}
                        {{!-- {{ Found the post of this user}} --}}
                        {{#if (equalString patient.username userDataPost.username)}}
                            {{#if userDataPost.dataLevel}}
                                {{!-- {{ Upper threshold is breached}} --}}
                                {{#if (isGreater userDataPost.exerciseLevel patient.exerciseUpper)}} <p style="color:red">Exercise Level: {{userDataPost.exerciseLevel}} steps</p> 
                                {{!-- {{ Lower threshold is breached}} --}}  
                                {{else if (isLess userDataPost.exerciseLevel patient.exerciseLower)}} <p style="color:red">Exercise Level: {{userDataPost.exerciseLevel}} steps</p> 
                                
                                {{!-- {{ Neither threshold breached }} --}}  
                                {{else}} <p>Exercise Level: {{userDataPost.exerciseLevel}} steps</p>
                                {{/if}}
                                <p>Exercise Comment: {{userDataPost.dataComment}}</p>
                            {{/if}}
                        {{/if}}

                    {{/each}}
                {{/if}}

                {{!-- {{ Check to see if the Dr needs to see glucose}} --}}
                {{#if patient.glucoseRequired}}
                    {{!-- {{ Iterate through every glucose post to find the most recent from this patient}} --}}
                    {{#each ../glucosePost as |glucosePost|}}

                        {{!-- {{ Found the post of this user}} --}}
                        {{#if (equalString patient.username glucosePost.username)}}
                            {{#if glucosePost.glucoseLevel}}
                                {{!-- {{ Upper threshold is breached}} --}}
                                {{#if (isGreater glucosePost.glucoseLevel patient.glucoseUpper)}} <p style="color:red">Glucose Level: {{glucosePost.glucoseLevel}} nmol/L</p> 
                                {{!-- {{ Lower threshold is breached}} --}}  
                                {{else if (isLess glucosePost.glucoseLevel patient.glucoseLower)}} <p style="color:red">Glucose Level: {{glucosePost.glucoseLevel}} nmol/L</p> 
                                
                                {{!-- {{ Neither threshold breached }} --}}  
                                {{else}} <p>Glucose Level: {{glucosePost.glucoseLevel}} nmol/L</p>
                                {{/if}}
                                <p>Glucose Comment: {{glucosePost.glucoseComment}}</p>
                                
                            {{/if}}
                            
                        {{/if}}

                    {{/each}}
                {{/if}}

                
                {{!-- {{ Check to see if the Dr needs to see exercise}} --}}
                {{#if patient.insulinRequired}}
                    {{!-- {{ Iterate through every glucose post to find the most recent from this patient}} --}}
                    {{#each ../insulinPost as |insulinPost|}}
                        {{!-- {{ Found the post of this user}} --}}
                        {{#if (equalString patient.username insulinPost.username)}}
                            {{#if insulinPost.exerciseLevel}}
                                {{!-- {{ Upper threshold is breached}} --}}
                                {{#if (isGreater insulinPost.exerciseLevel patient.exerciseUpper)}} <p style="color:red">Insulin Level: {{insulinPost.exerciseLevel}} steps</p> 
                                {{!-- {{ Lower threshold is breached}} --}}  
                                {{else if (isLess insulinPost.exerciseLevel patient.exerciseLower)}} <p style="color:red">Insulin Level: {{insulinPost.exerciseLevel}} steps</p> 
                                
                                {{!-- {{ Neither threshold breached }} --}}  
                                {{else}} <p>Exercise Level: {{insulinPost.exerciseLevel}} steps</p>
                                {{/if}}
                                <p>Exercise Comment: {{insulinPost.exerciseComment}}</p>
                            {{/if}}
                        {{/if}}

                    {{/each}}
                {{/if}}
            </div>
        {{/each}}
    </div>
</div>
